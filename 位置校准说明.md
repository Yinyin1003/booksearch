# 书籍位置校准说明

## 问题

如果找到的书籍高亮位置不准确，需要调整书籍在照片中的位置坐标。

## 方法一：使用校准工具（推荐）

### 1. 运行校准工具

```bash
cd /Users/zhouyinyin/Downloads/booksearch
python3 calibrate_positions.py /Users/zhouyinyin/Downloads/bookshelf.jpg
```

### 2. 操作步骤

1. **选择书籍位置**：
   - 在图片上点击并拖拽，绘制红色框选择书籍位置
   - 红色框会实时显示你选择的范围

2. **保存位置**：
   - 按 `s` 键保存当前书籍的位置

3. **切换书籍**：
   - 按 `n` 键切换到下一本书
   - 按 `p` 键切换到上一本书

4. **重置选择**：
   - 按 `r` 键重置当前选择，重新绘制

5. **完成校准**：
   - 按 `q` 键退出并保存

### 3. 可视化说明

- **红色框**：当前正在选择的位置
- **蓝色框**：当前书籍的已保存位置
- **绿色框**：其他书籍的已保存位置

### 4. 校准单个书籍

如果只想校准某一本书：

```bash
python3 calibrate_positions.py bookshelf.jpg rethinking
```

## 方法二：手动编辑坐标

如果不想使用工具，可以直接编辑 `book_database.py` 文件：

```python
"book_name": {
    "position": (x, y, width, height),  # 归一化坐标 (0-1)
    "shelf": 0,  # 0 = 上排, 1 = 下排
    "full_name": "完整书名"
}
```

### 坐标说明

- `x, y`: 书籍在图片中的**中心位置**（0-1之间）
  - `x = 0` 表示图片最左边
  - `x = 1` 表示图片最右边
  - `y = 0` 表示图片最上边
  - `y = 1` 表示图片最下边

- `width, height`: 书籍的**宽度和高度**（0-1之间）
  - `width = 0.1` 表示书籍宽度占图片宽度的10%
  - `height = 0.15` 表示书籍高度占图片高度的15%

### 示例

假设图片尺寸是 4284x5712 像素，书籍位于：
- 水平位置：图片宽度的 30% 处（x = 0.3）
- 垂直位置：图片高度的 25% 处（y = 0.25）
- 书籍宽度：图片宽度的 12%（width = 0.12）
- 书籍高度：图片高度的 12%（height = 0.12）

那么坐标应该是：
```python
"position": (0.3, 0.25, 0.12, 0.12)
```

## 快速调整技巧

1. **先找到大致位置**：
   - 如果书籍在图片左侧，x 值应该 < 0.5
   - 如果书籍在图片右侧，x 值应该 > 0.5
   - 如果书籍在上排，y 值应该 < 0.5
   - 如果书籍在下排，y 值应该 > 0.5

2. **微调大小**：
   - 如果高亮框太小，增加 width 和 height
   - 如果高亮框太大，减小 width 和 height

3. **使用校准工具**：
   - 工具会显示当前坐标值
   - 可以直接看到调整效果
   - 更直观、更准确

## 注意事项

- 坐标是**归一化的**（0-1），不是像素值
- 坐标表示书籍的**中心点**，不是左上角
- 调整后需要重启程序才能看到效果
- 建议使用校准工具，更直观准确

